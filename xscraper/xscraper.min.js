var xscraper=(()=>{var H=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var D=(t,e)=>{for(var n in e)H(t,n,{get:e[n],enumerable:!0})},ee=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of X(e))!Y.call(t,r)&&r!==n&&H(t,r,{get:()=>e[r],enumerable:!(o=Q(e,r))||o.enumerable});return t};var te=t=>ee(H({},"__esModule",{value:!0}),t);var ce={};D(ce,{addBuzzKeep:()=>G,createScraperState:()=>J,mergeTweets:()=>$,parseCount:()=>O,scrape:()=>ie,xTweets:()=>R});var P=J();function J(t){let e=Object.create(null);if(t)for(let[n,o]of Object.entries(t))e[n]=o;return{tweetsByLink:e,captureTimer:null,autoScrollTimer:null,seenCount:0,scrollPhase:"toTop",topStableTicks:0}}function O(t){if(!t)return 0;let e=String(t).trim().replace(/,/g,""),n=e.match(/^([0-9]*\.?[0-9]+)\s*([KkMm])?$/);if(!n)return Number.parseInt(e,10)||0;let o=Number.parseFloat(n[1]),r=n[2]?/k/i.test(n[2])?1e3:1e6:1;return Math.round(o*r)}function K(t){if(!t)return 0;let o=((t.closest?.("button")?.getAttribute?.("aria-label")||t.getAttribute?.("aria-label")||"").match(/([0-9][0-9,\.]*)(?:\s+(?:likes?|repl(?:y|ies)|views?))/i)||[])[1];if(o)return O(o);let r=t.querySelector('[data-testid="app-text-transition-container"] span, span');return O(r?.textContent||"0")}function ne(t){let e=t.querySelector('[data-testid="socialContext"]');if(e&&/promoted|sponsored|ad/i.test(e.textContent||""))return!0;let n=(t.textContent||"").split(`
`).slice(0,3).join(" ");return!!/\bPromoted\b/i.test(n)}function R(t=document){let e=[],n=t.querySelectorAll('article[role="article"]');for(let r of n){if(ne(r))continue;let p=(r.querySelector('a[role="link"][href*="/status/"] time, time')?.closest?.('a[role="link"][href*="/status/"]')||r.querySelector('a[role="link"][href*="/status/"]'))?.getAttribute?.("href");if(!p)continue;let m=new URL(p,t.location?.origin||"https://x.com").href,w=r.querySelector('div[data-testid="User-Name"]'),g=null,_=null;if(w){let B=[...w.querySelectorAll("span")].map(l=>l.textContent?.trim()).filter(Boolean);_=B.find(l=>/^@/.test(l))?.replace(/^@/,"")||null,g=B.find(l=>l&&!/^@/.test(l))||null}let M=r.querySelector("time")?.getAttribute?.("datetime")||null;if(!M)continue;let A=r.querySelector('div[data-testid="tweetText"]')?.innerText?.trim?.()||null,V=K(r.querySelector('div[data-testid="like"]')),q=K(r.querySelector('div[data-testid="reply"]')),v=K(r.querySelector('div[data-testid="views"], div[data-testid="view"] , a[href*="/analytics"] div[data-testid], a[href*="/status/"] div[aria-label*="Views"]')),b=le(r),C=Math.max(V||0,b.likes||0),L=Math.max(q||0,b.replies||0),E=Math.max(v||0,b.views||0);delete b.likes,delete b.replies,delete b.views,e.push({link:m,name:g,handle:_,date:M,message:A,likes:C,replies:L,views:E,...b})}let o=e[0]?.link;if(o)for(let r=1;r<e.length;r++)e[r].parent_link=o;return e}function $(t,e=P){for(let n of t){if(!n?.link)continue;let o=e.tweetsByLink[n.link]||{};for(let[r,c]of Object.entries(n)){let a=o[r];typeof c=="string"?(c?.length||0)>(a?.length||0)&&(o[r]=c):typeof c=="number"?(c||0)>(a||0)&&(o[r]=c):a||(o[r]=c)}e.tweetsByLink[n.link]=o}}function se(t=document){let e=[...t.querySelectorAll('div[role="button"], button')];for(let n of e){let o=(n.innerText||"").toLowerCase();o&&(/show/.test(o)&&/repl/.test(o)||/view/.test(o)&&/repl/.test(o)||/show more/.test(o)&&!/reply|repl/.test(o))&&n.click()}}function re({rootDocument:t=document,state:e=P}={}){let n=t.defaultView,o=()=>{se(t);let r=e.seenCount,c=R(t);$(c,e);let a=Object.keys(e.tweetsByLink).length;a>r&&(e.seenCount=a);let p=t.scrollingElement||t.documentElement||t.body;if(p){if(e.scrollPhase==="toTop"){let m=p.scrollTop;n?.scrollBy?.(0,-Math.max(200,n.innerHeight*.9)),p.scrollTop<=0||p.scrollTop===m?e.topStableTicks+=1:e.topStableTicks=0,e.topStableTicks>=3&&(e.scrollPhase="down");return}n?.scrollBy?.(0,Math.max(200,n.innerHeight*.9))}};t.defaultView?.scrollTo?.(0,0),o(),e.autoScrollTimer=t.defaultView?.setInterval?.(o,900)||null}function ie({document:t=document,navigator:e=typeof navigator>"u"?void 0:navigator,state:n=P,setIntervalFn:o=setInterval,clearIntervalFn:r=clearInterval}={}){let c="xscraper-copy-btn",a=t.getElementById(c);a&&a.remove(),t.body.insertAdjacentHTML("beforeend",`<button id="${c}" style="position:fixed;top:10px;right:10px;padding:10px;z-index:2147483647;background-color:#fff;color:#000;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,0.15);">Copy 0 tweets</button>`);let p=t.getElementById(c),m=()=>{$(R(t),n);let w=Object.values(n.tweetsByLink).length;p.textContent=`Copy ${w} tweets`};n.autoScrollTimer||re({rootDocument:t,state:n}),m(),n.captureTimer=o(m,600),p.addEventListener("click",async()=>{r(n.captureTimer),n.autoScrollTimer&&t.defaultView&&t.defaultView.clearInterval(n.autoScrollTimer),n.captureTimer=null,n.autoScrollTimer=null,p.remove();let w=Object.values(n.tweetsByLink),g=G(w);await e?.clipboard?.writeText?.(JSON.stringify(g,null,2))});try{t.defaultView.__xscraperState=n}catch{}}function oe(t){let e=t.toLowerCase();return e.startsWith("repl")?"replies":e.startsWith("retw")||e.startsWith("repo")?"reposts":e.startsWith("like")?"likes":e.startsWith("book")?"bookmarks":e.startsWith("view")?"views":e.startsWith("quot")?"quotes":e.replace(/s$/,"")}function le(t){let e={},n=t.querySelectorAll("[aria-label]");for(let o of n){let r=o.getAttribute("aria-label")||"",c=/(\d[\d,\.\s]*)\s*(repl(?:y|ies)|repost(?:s)?|retweet(?:s)?|like(?:s)?|bookmark(?:s)?|view(?:s)?|quote(?:s)?)/gi,a;for(;a=c.exec(r);){let p=O(a[1]),m=oe(a[2]);e[m]=Math.max(e[m]||0,p)}}return e}function G(t,e={}){let{halfLifeBuzzHours:n=72,halfLifeKeepHours:o=36,buzzWeights:r={likes:2,reposts:5},keepWeights:c={bookmarks:5,replies:4},now:a=new Date,z:p=1.96,debug:m=!1}=e,w=(l,s,i)=>Math.min(Math.max(l,s),i);function g(l,s){return(l.getTime()-s.getTime())/(1e3*60*60)}function _(l,s){return!isFinite(l)||s<=0?1:Math.exp(-Math.log(2)*l/s)}function S(l,s,i=p){if(!(s>0))return 0;let d=Math.min(l/s,1),u=1+i*i/s,f=(d*(1-d)+i*i/(4*s))/s,h=d+i*i/(2*s)-i*Math.sqrt(Math.max(f,0));return Math.max(h/u,0)}function M(l){let s=l.filter(Number.isFinite),i=s.reduce((u,f)=>u+f,0)/(s.length||1),d=Math.sqrt(s.reduce((u,f)=>u+(f-i)*(f-i),0)/(s.length||1))||1;return l.map(u=>Number.isFinite(u)?(u-i)/d:0)}function Z(l,s){let i=Math.min(l.length,s.length),d=0,u=0,f=0,h=0,x=0,k=0;for(let N=0;N<i;N++){let y=l[N],F=s[N];!Number.isFinite(y)||!Number.isFinite(F)||(d+=y,u+=F,f+=y*y,h+=F*F,x+=y*F,k++)}if(k===0)return 0;let T=d/k,z=u/k,I=f/k-T*T,W=h/k-z*z,U=x/k-T*z,j=Math.sqrt(I*W);return j>0?w(U/j,-1,1):0}function A(l,s=0,i=100){let d=l.filter(Number.isFinite),u=Math.min(...d,0),h=Math.max(...d,1)-u||1;return l.map(x=>s+(x-u)/h*(i-s))}let V=a instanceof Date?a:new Date(a),q=t.map(l=>{let s={...l},i=Number(s.views)||0,d=Number(s.likes)||0,u=Number(s.reposts)||0,f=Number(s.replies)||0,h=Number(s.bookmarks)||0,x=s.date?new Date(s.date):null,k=x instanceof Date&&!isNaN(x)?Math.max(0,g(V,x)):0,T=S(d,i),z=S(u,i),I=S(f,i),W=S(h,i),j=((r.reposts||0)*z+(r.likes||0)*T)*_(k,n),y=((c.bookmarks||0)*W+(c.replies||0)*I)*_(k,o);return{...s,views:i,likes:d,reposts:u,replies:f,bookmarks:h,age_hours:k,wlb_likes:T,wlb_reposts:z,wlb_replies:I,wlb_bookmarks:W,buzz_raw:j,keep_raw:y}}),v=M(q.map(l=>l.buzz_raw)),b=M(q.map(l=>l.keep_raw)),C=Z(b,v),L=b.map((l,s)=>l-C*v[s]),E=A(v,0,100),B=A(L,0,100);return q.map((l,s)=>{let i={...l,buzz:Number.isFinite(E[s])?+E[s].toFixed(2):0,keep:Number.isFinite(B[s])?+B[s].toFixed(2):0};return m?(i.buzz_z=+v[s].toFixed(4),i.keep_z=+b[s].toFixed(4),i.keep_orth_z=+L[s].toFixed(4),i.keep_buzz_corr=+C.toFixed(4)):(delete i.wlb_likes,delete i.wlb_reposts,delete i.wlb_replies,delete i.wlb_bookmarks,delete i.buzz_raw,delete i.keep_raw),i})}return te(ce);})();
