var discoursescraper=(()=>{var g=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var q=(e,t)=>{for(var n in t)g(e,n,{get:t[n],enumerable:!0})},B=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of M(t))!j.call(e,o)&&o!==n&&g(e,o,{get:()=>t[o],enumerable:!(r=I(t,o))||r.enumerable});return e};var L=e=>B(g({},"__esModule",{value:!0}),e);var X={};q(X,{createScraperState:()=>N,defaultState:()=>y,discoursePosts:()=>w,mergePosts:()=>$,parseCount:()=>A,scrape:()=>K});var y=N(),_={heart:"\u2665\uFE0F",heart_on_fire:"\u2764\uFE0F\u200D\u{1F525}","+1":"\u{1F44D}","-1":"\u{1F44E}",laugh:"\u{1F606}",laughing:"\u{1F606}",joy:"\u{1F602}",grin:"\u{1F601}",smile:"\u{1F604}",open_mouth:"\u{1F62E}",scream:"\u{1F631}",cry:"\u{1F62D}",sob:"\u{1F62D}",clap:"\u{1F44F}",raised_hands:"\u{1F64C}",tada:"\u{1F389}",confetti_ball:"\u{1F38A}",rocket:"\u{1F680}",thinking:"\u{1F914}",eyes:"\u{1F440}",star_struck:"\u{1F929}",fire:"\u{1F525}",100:"\u{1F4AF}"};function N(e){let t=Object.create(null);if(e)for(let[n,r]of Object.entries(e))t[n]=r;return{postsById:t,captureTimer:null,autoScrollTimer:null,seenCount:0,scrollPhase:"toTop",topStableTicks:0}}function A(e){if(!e)return 0;let t=String(e).trim().replace(/,/g,""),n=t.match(/^([0-9]*\.?[0-9]+)\s*([KkMm])$/);if(!n)return Number.parseInt(t,10)||0;let r=Number.parseFloat(n[1]),o=n[2].toLowerCase()==="k"?1e3:1e6;return Math.round(r*o)}function O(e){let n=e.defaultView?.Discourse?.__container__;if(!n?.lookup)return null;try{return n.lookup("controller:topic")||null}catch{return null}}function v(e,t){let{location:n}=e.defaultView||{},o=(n?.pathname||"").match(/^\/t\/([^/]+)\/(\d+)(?:\/\d+)?/);if(o)return`${n.origin}/t/${o[1]}/${o[2]}`;let s=t?.model;if(s?.relative_url&&n?.origin)return new URL(s.relative_url,n.origin).href.replace(/\/\d+$/,"");let l=e.querySelector('link[rel="canonical"]')?.getAttribute("href");if(l){let c=new URL(l,n?.origin||"https://discourse.example.com"),u=c.pathname.split("/").slice(0,4).join("/");return`${c.origin}${u}`}return n?.href?n.href.replace(/\/\d+(?:\?.*)?$/,""):""}function k(e,t){return e?t===1?e:`${e}/${t}`:null}function F(e){if(!e)return null;if(_[e])return _[e];let t=e.replace(/:.+$/,"");return _[t]?_[t]:_[e.replace(/-/g,"_")]?_[e.replace(/-/g,"_")]:e}function V(e){let t=Object.create(null);if(Number.isFinite(e?.like_count)&&e.like_count>0&&(t["\u2665\uFE0F"]=e.like_count),Array.isArray(e?.reactions))for(let n of e.reactions){let r=Number(n?.count)||0;if(!r)continue;let o=F(n.id)||n.id,s=Number(t[o])||0;t[o]=Math.max(s,r)}if(Array.isArray(e?.actions_summary))for(let n of e.actions_summary){let{id:r,count:o}=n;Number(o)>0&&r===2&&(t["\u2665\uFE0F"]=Math.max(Number(t["\u2665\uFE0F"])||0,o))}return t}function x(e,t){if(!e)return null;try{return new URL(e,t.defaultView?.location?.href||"https://discourse.example.com").href}catch{return e}}function C(e,t){if(!e)return"";let n=t.createElement("div");return n.innerHTML=e,n.querySelectorAll("script, style, noscript").forEach(r=>r.remove()),n.querySelectorAll("span.mention, a.mention").forEach(r=>{r.replaceWith(`@${r.textContent?.replace(/^@/,"")||""}`.trim())}),n.querySelectorAll("img.emoji").forEach(r=>{let o=r.getAttribute("alt")||r.getAttribute("title")||"";r.replaceWith(o)}),h(p(n.childNodes,{listStack:[],rootDocument:t})).trim()}function p(e,t){let n="";return e.forEach(r=>{n+=R(r,t)}),n}function R(e,t){if(!e)return"";if(e.nodeType===e.TEXT_NODE)return H(e.textContent||"",t);if(e.nodeType!==e.ELEMENT_NODE)return"";let n=e.tagName.toLowerCase();switch(n){case"br":return`  
`;case"p":case"div":return U(p(e.childNodes,t));case"strong":case"b":{let r=p(e.childNodes,t).trim();return r?`**${r}**`:""}case"em":case"i":{let r=p(e.childNodes,t).trim();return r?`*${r}*`:""}case"code":{let r=e.parentElement?.tagName.toLowerCase(),o=(e.textContent||"").replace(/\s+/g," ").trim();return o?r==="pre"?o:`\`${o}\``:""}case"pre":{let r=e.textContent||"";return r.trim()?`

\`\`\`
${r.replace(/\s+$/,"")}
\`\`\`

`:""}case"blockquote":{let r=h(p(e.childNodes,t).trim());return r?`

${r.split(`
`).map(o=>`> ${o.trim()}`).join(`
`)}

`:""}case"ul":case"ol":{let r=n==="ol";t.listStack.push(r?"ol":"ul");let s=[...e.children].filter(l=>l.tagName.toLowerCase()==="li").map((l,c)=>T(l,t,r?c+1:null)).filter(Boolean).join(`
`);return t.listStack.pop(),`
${s}
`}case"li":return T(e,t,null);case"hr":return`

---

`;case"a":{let r=e.getAttribute("href"),o=p(e.childNodes,t).trim()||r;if(!r)return o;let s=x(r,t.rootDocument||document);return`[${o}](${s||r})`}case"img":{let r=e.getAttribute("alt")||"",o=e.getAttribute("src");return o?`![${r}](${o})`:r}case"table":{let r=[...e.querySelectorAll("tr")];if(!r.length)return"";let o=r.map(a=>[...a.children].map(i=>h(i.textContent||"").trim())),s=o[0],l=s.map(()=>"---"),c=o.slice(1);return`
${[s,l,...c].map(a=>`| ${a.join(" | ")} |`).join(`
`)}

`}default:return p(e.childNodes,t)}}function T(e,t,n){let r=t.listStack.length-1,o=r>0?"  ".repeat(r):"",s=t.listStack.at(-1)==="ol"?`${n??1}. `:"- ",l=h(p(e.childNodes,t).trim());if(!l)return"";let c=l.split(`
`),[u,...a]=c,i=a.map(m=>`${o}  ${m}`).join(`
`);return`${o}${s}${u}${i?`
${i}`:""}`}function H(e,t){if(!e)return"";let n=e.replace(/\s+/g," ");return t.listStack?.length,n}function U(e){let t=h(e).trim();return t?`

${t}

`:""}function h(e){return e.replace(/\u00a0/g," ").replace(/\n{3,}/g,`

`)}function P(e,t){let n=e?.model,r=Array.isArray(n?.postStream?.posts)?n.postStream.posts:[],o=v(t,e),s=n?.title||t.title||null,l=n?.id||null,c=n?.slug||null,u=o||t.defaultView?.location?.href||null,a=[];for(let i of r){if(!i||i.post_type&&i.post_type!==1)continue;let m=i.cooked||"";if(!m.trim())continue;let d=Number(i.post_number)||1,f={topic_id:l,topic_slug:c,topic_title:s,topic_url:u,post_id:i.id,post_number:d,reply_to_post_number:i.reply_to_post_number??null,date:i.created_at||i.updated_at||null,link:k(o,d),parent_link:i.reply_to_post_number?k(o,i.reply_to_post_number):null,user_id:i.user_id??null,user_name:i.name||i.username||null,user_username:i.username||null,user_link:i.username?`/u/${i.username}`:null,user_role:i.user_title||null,message:C(m,t),likes:V(i)};Number.isFinite(i.reads)&&(f.reads=i.reads),Number.isFinite(i.reply_count)&&(f.reply_count=i.reply_count),Array.isArray(i.link_counts)&&i.link_counts.length&&(f.links=i.link_counts.map(b=>({url:x(b.url,t),title:b.title||null,clicks:b.clicks??null,internal:b.internal??null}))),Array.isArray(i.replies_to_post_number)&&(f.replies_to_post_number=i.replies_to_post_number),a.push(f)}return a.length&&Number.isFinite(n?.views)&&(a[0].views=n.views),a}function z(e){let t=v(e,null),n=e.title||null,r=e.defaultView?.location?.href||null,o=e.querySelectorAll("article[data-post-id]"),s=[];for(let u of o){let a=u.querySelector(".cooked");if(!a)continue;let i=u.getAttribute("data-post-id"),m=u.id?.match?.(/post_(\d+)/),d=m?Number(m[1]):null,f=u.querySelector("time")?.getAttribute("datetime"),S=u.querySelector(".names span.username, .poster span.username")?.textContent?.trim()||null,E=u.querySelector(".names span.username a, .poster span.username a")?.getAttribute("href");s.push({topic_title:n,topic_url:r,post_id:i?Number(i):null,post_number:d,reply_to_post_number:null,date:f||null,link:d?k(t,d):t,parent_link:null,user_name:S,user_username:S,user_link:E||null,user_role:u.querySelector(".names .title")?.textContent?.trim()||null,message:C(a.innerHTML,e),likes:{}})}let l=e.querySelector(".topic-map__views-trigger .number"),c=s[0];return c&&l&&(c.views=A(l.textContent||"")),s}function w(e=document){let t=O(e),r=(t?P(t,e):z(e)).slice().sort((o,s)=>(o.post_number||0)-(s.post_number||0));return r.map((o,s)=>(!o.parent_link&&s>0&&!o.reply_to_post_number&&(o.parent_link=r[0]?.link||o.parent_link),o))}function $(e,t=y){for(let n of e){let r=n.post_id||n.link;if(!r)continue;let o=t.postsById[r]||{};for(let[s,l]of Object.entries(n)){let c=o[s];typeof l=="string"?(l?.length||0)>(c?.length||0)&&(o[s]=l):Number.isFinite(l)?Number.isFinite(c)?o[s]=Math.max(c,l):o[s]=l:l&&typeof l=="object"?o[s]={...c,...l}:l!==void 0&&c==null&&(o[s]=l)}t.postsById[r]=o}}function W(e){let t=[...e.querySelectorAll('button, a[role="button"], .timeline-down .timeline-button')];for(let n of t){let r=`${n.textContent||""} ${n.getAttribute("aria-label")||""}`.toLowerCase();r&&/show more|load more|expand|continue|view replies|summary|top replies/.test(r)&&n.click()}}function J({rootDocument:e=document,state:t=y}={}){let n=e.defaultView;if(!n)return;let r=()=>{W(e);let o=t.seenCount;$(w(e),t);let s=Object.keys(t.postsById).length;s>o&&(t.seenCount=s);let l=e.scrollingElement||e.documentElement||e.body;if(l){if(t.scrollPhase==="toTop"){let c=l.scrollTop;n.scrollBy(0,-Math.max(200,n.innerHeight*.9)),l.scrollTop<=0||l.scrollTop===c?t.topStableTicks+=1:t.topStableTicks=0,t.topStableTicks>=3&&(t.scrollPhase="down");return}n.scrollBy(0,Math.max(300,n.innerHeight*.9))}};n.scrollTo(0,0),r(),t.autoScrollTimer=n.setInterval(r,1e3)}function K({document:e=document,navigator:t=typeof navigator>"u"?void 0:navigator,state:n=y,setIntervalFn:r=setInterval,clearIntervalFn:o=clearInterval}={}){let s="discoursescraper-copy-btn";e.getElementById(s)?.remove(),e.body.insertAdjacentHTML("beforeend",`<button id="${s}" style="position:fixed;top:10px;right:10px;padding:10px;z-index:2147483647;background-color:#fff;color:#000;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,0.15);">Copy 0 posts</button>`);let l=e.getElementById(s);n.autoScrollTimer||J({rootDocument:e,state:n});let c=()=>{$(w(e),n);let u=Object.keys(n.postsById).length;l.textContent=`Copy ${u} posts`};c(),n.captureTimer=r(c,700),l.addEventListener("click",async()=>{o(n.captureTimer),n.captureTimer=null,n.autoScrollTimer&&e.defaultView&&e.defaultView.clearInterval(n.autoScrollTimer),n.autoScrollTimer=null,l.remove();let u=Object.values(n.postsById).sort((a,i)=>(a.post_number||0)-(i.post_number||0));await t?.clipboard?.writeText?.(JSON.stringify(u,null,2))});try{e.defaultView.__discoursescraperState=n}catch{}}return L(X);})();
