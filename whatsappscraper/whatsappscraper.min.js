var whatsappscraper=(()=>{var f=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var I=(t,e)=>{for(var s in e)f(t,s,{get:e[s],enumerable:!0})},w=(t,e,s,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of T(e))!A.call(t,a)&&a!==s&&f(t,a,{get:()=>e[a],enumerable:!(o=S(e,a))||o.enumerable});return t};var v=t=>w(f({},"__esModule",{value:!0}),t);var j={};I(j,{scrape:()=>$,whatsappMessages:()=>h});function h(){let t=[],e,s;for(let o of document.querySelectorAll('#main [role="row"]')){let[a,n,l,q,b,O]=o.querySelector("[data-id]").dataset.id.split(/[_@]/);a=a==="true";let m=!!o.querySelector('[data-icon="recalled"]'),r={messageId:q,authorPhone:b,isSystemMessage:a,isRecalled:m,userId:n};if(a&&!m&&(r.text=o.outerText),!a&&!m&&(r.text=o.querySelector(".selectable-text")?.outerText,r.author=o.querySelector('[role=""] [dir]')?.textContent,r.text?r.author||(r.author=e):r.text=o.textContent,r.time=C(o.querySelector("[data-pre-plain-text]")?.dataset.prePlainText),!r.time)){let c=[...o.querySelectorAll('[dir="auto"]')].at(-1);c&&(r.time=D(s,c.textContent))}s=r.time,e=r.author;let u=o.querySelector('[aria-label="Quoted message" i]');if(u){let c=u.querySelector('[role=""] :not([aria-label])')?.textContent,p=u.querySelector('[role=""] [aria-label]')?.textContent;if(p?(r.quoteAuthorPhone=c.replace(/[^0-9]+/g,""),r.quoteAuthor=p):r.quoteAuthor=c,r.quoteText=u.querySelector(".quoted-mention")?.outerText,r.quoteText)for(let i=t.length-1;i>=0;i--){let y=r.quoteText.replace(/\s+/gs," ");if(r.quoteAuthor==t[i].author&&t[i].text&&t[i].text.replace(/\s+/gs," ").startsWith(y)){r.quoteMessageId=t[i].messageId;break}}}let g=o.querySelector('[aria-label^="Reactions "],[aria-label^="reaction "]');g&&(r.reactions=g.getAttribute("aria-label").replace(/^reactions? */i,"").replace(/ *in total$/i,"")),t.push(r)}return t}function C(t){let e=t?.match?.(/\[(\d{1,2}:\d{2}\s?[ap]m),\s?(\d{1,2})\/(\d{1,2})\/(\d{4})\]/);return e?new Date(`${e[4]}-${e[3]}-${e[2]} ${e[1]}`):null}function D(t,e){let s=e.match(/(\d+):(\d+)\s+(am|pm)/i);if(!s)return null;let[o,a]=s.slice(1,3).map(Number),n=/pm/i.test(e),l=t?new Date(t):new Date;return l.setHours(o%12+(n?12:0),a,0,0),l.toISOString()}var d={},x;function M(t){for(let e of t){let s=d[e.messageId]||{};for(let[o,a]of Object.entries(e)){let n=s[o];typeof a=="string"?(a?.length||0)>(n?.length||0)&&(s[o]=a):n||(s[o]=a)}d[e.messageId]=s}}function $(){document.body.insertAdjacentHTML("beforeend",'<button id="copy-btn" style="position:fixed;top:10px;right:10px;padding:10px;z-index:999;background-color:#fff;color:#000;">Copy 0 messsages</button>');let t=document.getElementById("copy-btn"),e=()=>{M(h()),t.textContent=`Copy ${Object.values(d).filter(s=>s.text).length} messages`};e(),x=setInterval(e,500),t.addEventListener("click",async()=>{clearInterval(x),t.remove();let s=Object.values(d).sort((o,a)=>{let n=o.time?new Date(o.time).getTime():0,l=a.time?new Date(a.time).getTime():0;return n-l});await navigator.clipboard.writeText(JSON.stringify(s,null,2))})}return v(j);})();
