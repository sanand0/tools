var whatsappscraper=(()=>{var f=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var I=(t,e)=>{for(var n in e)f(t,n,{get:e[n],enumerable:!0})},w=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of T(e))!A.call(t,a)&&a!==n&&f(t,a,{get:()=>e[a],enumerable:!(r=S(e,a))||r.enumerable});return t};var v=t=>w(f({},"__esModule",{value:!0}),t);var j={};I(j,{scrape:()=>$,whatsappMessages:()=>h});function h(){let t=[],e,n;for(let r of document.querySelectorAll('#main [role="row"]')){let[a,s,l,q,b,O]=r.querySelector("[data-id]").dataset.id.split(/[_@]/);a=a==="true";let m=!!r.querySelector('[data-icon="recalled"]'),o={messageId:q,authorPhone:b,isSystemMessage:a,isRecalled:m,userId:s};if(a&&delete o.authorPhone,a&&!m&&(o.text=r.outerText),!a&&!m&&(o.text=r.querySelector(".selectable-text")?.outerText,o.author=r.querySelector('[role=""] [dir]')?.textContent,o.text?o.author||(o.author=e):o.text=r.textContent,o.time=C(r.querySelector("[data-pre-plain-text]")?.dataset.prePlainText),!o.time)){let c=[...r.querySelectorAll('[dir="auto"]')].at(-1);c&&(o.time=D(n,c.textContent))}n=o.time,e=o.author;let u=r.querySelector('[aria-label="Quoted message" i]');if(u){let c=u.querySelector('[role=""] :not([aria-label])')?.textContent,g=u.querySelector('[role=""] [aria-label]')?.textContent;if(g?(o.quoteAuthorPhone=c.replace(/[^0-9]+/g,""),o.quoteAuthor=g):o.quoteAuthor=c,o.quoteText=u.querySelector(".quoted-mention")?.outerText,o.quoteText)for(let i=t.length-1;i>=0;i--){let y=o.quoteText.replace(/\s+/gs," ");if(o.quoteAuthor==t[i].author&&t[i].text&&t[i].text.replace(/\s+/gs," ").startsWith(y)){o.quoteMessageId=t[i].messageId;break}}}let p=r.querySelector('[aria-label^="Reactions "],[aria-label^="reaction "]');p&&(o.reactions=p.getAttribute("aria-label").replace(/view reactions/i,"").replace(/^reactions? */i,"").replace(/ *in total/i,"").replace(/[, \.]+$/,"")),t.push(o)}return t}function C(t){let e=t?.match?.(/\[(\d{1,2}:\d{2}\s?[ap]m),\s?(\d{1,2})\/(\d{1,2})\/(\d{4})\]/);return e?new Date(`${e[4]}-${e[3]}-${e[2]} ${e[1]}`):null}function D(t,e){let n=e.match(/(\d+):(\d+)\s+(am|pm)/i);if(!n)return null;let[r,a]=n.slice(1,3).map(Number),s=/pm/i.test(e),l=t?new Date(t):new Date;return l.setHours(r%12+(s?12:0),a,0,0),l.toISOString()}var d={},x;function M(t){for(let e of t){let n=d[e.messageId]||{};for(let[r,a]of Object.entries(e)){let s=n[r];typeof a=="string"?(a?.length||0)>(s?.length||0)&&(n[r]=a):s||(n[r]=a)}d[e.messageId]=n}}function $(){document.body.insertAdjacentHTML("beforeend",'<button id="copy-btn" style="position:fixed;top:10px;right:10px;padding:10px;z-index:999;background-color:#fff;color:#000;">Copy 0 messsages</button>');let t=document.getElementById("copy-btn"),e=()=>{M(h()),t.textContent=`Copy ${Object.values(d).filter(n=>n.text).length} messages`};e(),x=setInterval(e,500),t.addEventListener("click",async()=>{clearInterval(x),t.remove();let n=Object.values(d).sort((r,a)=>{let s=r.time?new Date(r.time).getTime():0,l=a.time?new Date(a.time).getTime():0;return s-l});await navigator.clipboard.writeText(JSON.stringify(n,null,2))})}return v(j);})();
