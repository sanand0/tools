var whatsappscraper=(()=>{var h=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var j=(r,e)=>{for(var n in e)h(r,n,{get:e[n],enumerable:!0})},O=(r,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of C(e))!M.call(r,a)&&a!==n&&h(r,a,{get:()=>e[a],enumerable:!(i=$(e,a))||i.enumerable});return r};var B=r=>O(h({},"__esModule",{value:!0}),r);var k={};j(k,{createScraperState:()=>T,mergeMessages:()=>I,scrape:()=>P,whatsappMessages:()=>w});var S=T();function T(r){let e=Object.create(null);if(r)for(let[n,i]of Object.entries(r))e[n]=i;return{messagesById:e,captureTimer:null}}function w(r=document){let e=[],n,i;for(let a of r.querySelectorAll('#main [role="row"]')){let s,t=!1,l=!1,[c,u,p,x,v,L]=a.querySelector("[data-id]").dataset.id.split(/[_@]/);c=c==="true";let m=!!a.querySelector('[data-icon="recalled"]'),o={messageId:x,authorPhone:v,isSystemMessage:c,isRecalled:m,userId:u};if(c&&delete o.authorPhone,c&&!m&&(o.text=a.outerText),!c&&!m&&(s=a.querySelector(".selectable-text")?.outerText,l=!!a.querySelector('[aria-label="Play GIF" i]'),o.author=a.querySelector('[role=""] [dir]')?.textContent,s||(l?s="(media-gif)":(s=a.textContent,t=!0)),!o.author&&s&&(o.author=n),o.time=D(a.querySelector("[data-pre-plain-text]")?.dataset.prePlainText),!o.time)){let g=[...a.querySelectorAll('[dir="auto"]')].at(-1);g&&(o.time=E(i,g.textContent))}let b=a.querySelector('[aria-label="Quoted message" i]');if(b){let d=b.querySelector('[role=""] :not([aria-label])')?.textContent,g=b.querySelector('[role=""] [aria-label]')?.textContent;if(g?(o.quoteAuthorPhone=d.replace(/[^0-9]+/g,""),o.quoteAuthor=g):o.quoteAuthor=d,o.quoteText=b.querySelector(".quoted-mention")?.outerText,o.quoteText)for(let f=e.length-1;f>=0;f--){let A=o.quoteText.replace(/\s+/gs," ").trim();if(o.quoteAuthor==e[f].author&&e[f].text&&e[f].text.replace(/\s+/gs," ").trim().startsWith(A)){o.quoteMessageId=e[f].messageId;break}}}let q=a.querySelector('[aria-label^="Reactions "],[aria-label^="reaction "]');if(q&&(o.reactions=q.getAttribute("aria-label").replace(/view reactions/i,"").replace(/^reactions? */i,"").replace(/ *in total/i,"").replace(/[, .]+$/,"")),!c&&!m){let d=R(s,{author:o.author,quoteAuthor:o.quoteAuthor,quoteText:o.quoteText,usedFallback:t,hasGif:l});d?o.text=d:delete o.text}o.time&&(i=o.time),o.author&&(n=o.author),e.push(o)}return e}function D(r){let e=r?.match?.(/\[(\d{1,2}:\d{2}\s?[ap]m),\s?(\d{1,2})\/(\d{1,2})\/(\d{4})\]/);return e?new Date(`${e[4]}-${e[3]}-${e[2]} ${e[1]}`):null}function E(r,e){let n=e.match(/(\d+):(\d+)\s+(am|pm)/i);if(!n)return null;let[i,a]=n.slice(1,3).map(Number),s=/pm/i.test(e),t=r?new Date(r):new Date;return t.setHours(i%12+(s?12:0),a,0,0),t.toISOString()}function I(r,e=S){for(let n of r){let i=e.messagesById[n.messageId]||{};for(let[a,s]of Object.entries(n)){let t=i[a];typeof s=="string"?(s?.length||0)>(t?.length||0)&&(i[a]=s):t||(i[a]=s)}e.messagesById[n.messageId]=i}}function P({document:r=document,navigator:e=typeof navigator>"u"?void 0:navigator,state:n=S,setIntervalFn:i=setInterval,clearIntervalFn:a=clearInterval}={}){r.body.insertAdjacentHTML("beforeend",'<button id="copy-btn" style="position:fixed;top:10px;right:10px;padding:10px;z-index:999;background-color:#fff;color:#000;">Copy 0 messages</button>');let s=r.getElementById("copy-btn"),t=()=>{I(w(r),n),s.textContent=`Copy ${Object.values(n.messagesById).filter(l=>l.text).length} messages`};t(),n.captureTimer=i(t,500),s.addEventListener("click",async()=>{a(n.captureTimer),n.captureTimer=null,s.remove();let l=Object.values(n.messagesById).sort((c,u)=>{let p=c.time?new Date(c.time).getTime():0,x=u.time?new Date(u.time).getTime():0;return p-x});await e?.clipboard?.writeText?.(JSON.stringify(l,null,2))})}function R(r,{author:e,quoteAuthor:n,quoteText:i,usedFallback:a,hasGif:s}={}){if(typeof r!="string")return r;let t=r;if(i){let l=i.replace(/\s+/g," ").trim(),c=[i,l,l.replace(/^"|"$/g,"")];for(let u of c){if(!u)continue;let p=y(u);p&&(t=t.replace(new RegExp(p,"gi"),""))}}if(a&&e){let l=y(e);t=t.replace(new RegExp(`^${l}\\s*`,"i"),"")}if(a&&n){let l=y(n);t=t.replace(new RegExp(l,"gi"),"")}return a&&(t=t.replace(/\bMaybe\b/gi,""),t=t.replace(/\+?\d[\d\s-]{5,}/g,"")),t=t.replace(/Your browser doesn't support video playback\.?/gi,"").replace(/\btenor\b/gi,"").replace(/\bforward-[\w-]+\b/gi,"").replace(/\b\d{1,2}:\d{2}\s*(?:am|pm)\b/gi,""),(s||/media-gif/i.test(t))&&(t="(media-gif)"),t=t.replace(/[“”]/g,'"'),t=t.replace(/\s+/g," ").trim(),t=t.replace(/^["']+|["']+$/g,"").trim(),t||(s?"(media-gif)":null)}function y(r){return r?r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):""}return B(k);})();
