var whatsappscraper=(()=>{var m=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var T=(e,t)=>{for(var s in t)m(e,s,{get:t[s],enumerable:!0})},A=(e,t,s,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of S(t))!b.call(e,r)&&r!==s&&m(e,r,{get:()=>t[r],enumerable:!(a=y(t,r))||a.enumerable});return e};var C=e=>A(m({},"__esModule",{value:!0}),e);var D={};T(D,{scrape:()=>$,whatsappMessages:()=>x});function x(){let e=[],t,s;for(let a of document.querySelectorAll('#main [role="row"]')){let[r,i,u,q,f,M]=a.querySelector("[data-id]").dataset.id.split(/[_@]/);r=r==="true";let d=!!a.querySelector('[data-icon="recalled"]'),o={messageId:q,authorPhone:f,isSystemMessage:r,isRecalled:d,userId:i};if(r&&!d&&(o.text=a.outerText),!r&&!d&&(o.text=a.querySelector(".selectable-text")?.outerText,o.author=a.querySelector('[role=""] [dir]')?.textContent,o.text?o.author||(o.author=t):o.text=a.textContent,o.time=w(a.querySelector("[data-pre-plain-text]")?.dataset.prePlainText),!o.time)){let n=[...a.querySelectorAll('[dir="auto"]')].at(-1);n?o.time=I(s,n.textContent):console.log("MISSING TIME",a,o)}s=o.time,t=o.author;let c=a.querySelector('[aria-label="Quoted message" i]');if(c){let n=c.querySelector('[role=""] :not([aria-label])')?.textContent,p=c.querySelector('[role=""] [aria-label]')?.textContent;if(p?(o.quoteAuthorPhone=n.replace(/[^0-9]+/g,""),o.quoteAuthor=p):o.quoteAuthor=n,o.quoteText=c.querySelector(".quoted-mention")?.outerText,o.quoteText)for(let l=e.length-1;l>=0;l--){let g=o.quoteText.replace(/\s+/gs," ");if(o.quoteAuthor==e[l].author&&e[l].text&&e[l].text.replace(/\s+/gs," ").startsWith(g)){o.quoteMessageId=e[l].messageId;break}}}let h=a.querySelector('[aria-label^="Reactions "],[aria-label^="reaction "]');h&&(o.reactions=h.getAttribute("aria-label").replace(/^reactions? */i,"").replace(/ *in total$/i,"")),e.push(o)}return e}function w(e){let t=e?.match?.(/\[(\d{1,2}:\d{2}\s?[ap]m),\s?(\d{1,2})\/(\d{1,2})\/(\d{4})\]/);return t?new Date(`${t[4]}-${t[3]}-${t[2]} ${t[1]}`):null}function I(e,t){let s=t.match(/(\d+):(\d+)\s+(am|pm)/i);if(!s)return null;let[a,r]=s.slice(1,3).map(Number),i=/pm/i.test(t),u=e?new Date(e):new Date;return u.setHours(a%12+(i?12:0),r,0,0),u.toISOString()}async function $(){let e=x(),t=JSON.stringify(e,null,2);try{await navigator.clipboard.writeText(t),alert(`Copied ${e.length} messages`)}catch{let a=document.createElement("textarea");a.value=t,document.body.appendChild(a),a.select();let r=document.execCommand("copy");if(document.body.removeChild(a),r)alert(`Copied ${e.length} messages`);else throw new Error("Failed to copy to clipboard")}}return C(D);})();
