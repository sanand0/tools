var whatsappscraper=(()=>{var f=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var w=(t,e)=>{for(var a in e)f(t,a,{get:e[a],enumerable:!0})},A=(t,e,a,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of I(e))!T.call(t,r)&&r!==a&&f(t,r,{get:()=>e[r],enumerable:!(o=S(e,r))||o.enumerable});return t};var v=t=>A(f({},"__esModule",{value:!0}),t);var j={};w(j,{scrape:()=>E,whatsappMessages:()=>q});function q(){let t=[],e,a;for(let o of document.querySelectorAll('#main [role="row"]')){let[r,s,i,m,g,O]=o.querySelector("[data-id]").dataset.id.split(/[_@]/);r=r==="true";let p=!!o.querySelector('[data-icon="recalled"]'),n={messageId:m,authorPhone:g,isSystemMessage:r,isRecalled:p,userId:s};if(r&&!p&&(n.text=o.outerText),!r&&!p&&(n.text=o.querySelector(".selectable-text")?.outerText,n.author=o.querySelector('[role=""] [dir]')?.textContent,n.text?n.author||(n.author=e):n.text=o.textContent,n.time=D(o.querySelector("[data-pre-plain-text]")?.dataset.prePlainText),!n.time)){let c=[...o.querySelectorAll('[dir="auto"]')].at(-1);c?n.time=M(a,c.textContent):console.log("MISSING TIME",o,n)}a=n.time,e=n.author;let u=o.querySelector('[aria-label="Quoted message" i]');if(u){let c=u.querySelector('[role=""] :not([aria-label])')?.textContent,x=u.querySelector('[role=""] [aria-label]')?.textContent;if(x?(n.quoteAuthorPhone=c.replace(/[^0-9]+/g,""),n.quoteAuthor=x):n.quoteAuthor=c,n.quoteText=u.querySelector(".quoted-mention")?.outerText,n.quoteText)for(let l=t.length-1;l>=0;l--){let b=n.quoteText.replace(/\s+/gs," ");if(n.quoteAuthor==t[l].author&&t[l].text&&t[l].text.replace(/\s+/gs," ").startsWith(b)){n.quoteMessageId=t[l].messageId;break}}}let h=o.querySelector('[aria-label^="Reactions "],[aria-label^="reaction "]');h&&(n.reactions=h.getAttribute("aria-label").replace(/^reactions? */i,"").replace(/ *in total$/i,"")),t.push(n)}return t}function D(t){let e=t?.match?.(/\[(\d{1,2}:\d{2}\s?[ap]m),\s?(\d{1,2})\/(\d{1,2})\/(\d{4})\]/);return e?new Date(`${e[4]}-${e[3]}-${e[2]} ${e[1]}`):null}function M(t,e){let a=e.match(/(\d+):(\d+)\s+(am|pm)/i);if(!a)return null;let[o,r]=a.slice(1,3).map(Number),s=/pm/i.test(e),i=t?new Date(t):new Date;return i.setHours(o%12+(s?12:0),r,0,0),i.toISOString()}var d={},y;function C(t){for(let e of t){let a=d[e.messageId]||{};for(let[o,r]of Object.entries(e)){let s=a[o];typeof r=="string"?(r?.length||0)>(s?.length||0)&&(a[o]=r):s||(a[o]=r)}d[e.messageId]=a}}function E(){document.body.insertAdjacentHTML("beforeend",'<div id="copy-wrap" style="position:fixed;top:0;right:0"><button id="copy-btn">Copy</button><span id="msg-count" class="ms-2">0</span></div>');let t=document.getElementById("copy-wrap"),e=document.getElementById("copy-btn"),a=document.getElementById("msg-count"),o=()=>{C(q()),a.textContent=Object.values(d).filter(r=>r.text).length};o(),y=setInterval(o,500),e.addEventListener("click",async()=>{clearInterval(y),t.remove();let r=Object.values(d).sort((s,i)=>{let m=s.time?new Date(s.time).getTime():0,g=i.time?new Date(i.time).getTime():0;return m-g});await navigator.clipboard.writeText(JSON.stringify(r,null,2))})}return v(j);})();
