var whatsappscraper=(()=>{var h=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var j=(r,e)=>{for(var a in e)h(r,a,{get:e[a],enumerable:!0})},O=(r,e,a,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of C(e))!M.call(r,o)&&o!==a&&h(r,o,{get:()=>e[o],enumerable:!(i=$(e,o))||i.enumerable});return r};var B=r=>O(h({},"__esModule",{value:!0}),r);var k={};j(k,{createScraperState:()=>T,mergeMessages:()=>I,scrape:()=>P,whatsappMessages:()=>w});var S=T();function T(r){let e=Object.create(null);if(r)for(let[a,i]of Object.entries(r))e[a]=i;return{messagesById:e,captureTimer:null}}function w(r=document){let e=[],a,i;for(let o of r.querySelectorAll('#main [role="row"]')){let s,t=!1,l=!1,[c,d,f,x,v,L]=o.querySelector("[data-id]").dataset.id.split(/[_@]/);c=c==="true";let m=!!o.querySelector('[data-icon="recalled"]'),n={messageId:x,authorPhone:v,isSystemMessage:c,isRecalled:m,userId:d};if(c&&delete n.authorPhone,c&&!m&&(n.text=o.outerText),!c&&!m){s=o.querySelector(".selectable-text")?.outerText,l=!!o.querySelector('[aria-label="Play GIF" i]');let g=o.querySelector('[role=""]');if(n.author=g?.querySelector("[dir]")?.textContent,s||(l?s="(media-gif)":(s=o.textContent,t=!0)),!g&&!n.author&&s&&(n.author=a),n.time=D(o.querySelector("[data-pre-plain-text]")?.dataset.prePlainText),!n.time){let u=[...o.querySelectorAll('[dir="auto"]')].at(-1);u&&(n.time=E(i,u.textContent))}}i=n.time,a=n.author;let b=o.querySelector('[aria-label="Quoted message" i]');if(b){let p=b.querySelector('[role=""] :not([aria-label])')?.textContent,g=b.querySelector('[role=""] [aria-label]')?.textContent;if(g?(n.quoteAuthorPhone=p.replace(/[^0-9]+/g,""),n.quoteAuthor=g):n.quoteAuthor=p,n.quoteText=b.querySelector(".quoted-mention")?.outerText,n.quoteText)for(let u=e.length-1;u>=0;u--){let A=n.quoteText.replace(/\s+/gs," ").trim();if(n.quoteAuthor==e[u].author&&e[u].text&&e[u].text.replace(/\s+/gs," ").trim().startsWith(A)){n.quoteMessageId=e[u].messageId;break}}}let q=o.querySelector('[aria-label^="Reactions "],[aria-label^="reaction "]');if(q&&(n.reactions=q.getAttribute("aria-label").replace(/view reactions/i,"").replace(/^reactions? */i,"").replace(/ *in total/i,"").replace(/[, .]+$/,"")),!c&&!m){let p=R(s,{author:n.author,quoteAuthor:n.quoteAuthor,quoteText:n.quoteText,usedFallback:t,hasGif:l});p?n.text=p:delete n.text}e.push(n)}return e}function D(r){let e=r?.match?.(/\[(\d{1,2}:\d{2}\s?[ap]m),\s?(\d{1,2})\/(\d{1,2})\/(\d{4})\]/);return e?new Date(`${e[4]}-${e[3]}-${e[2]} ${e[1]}`):null}function E(r,e){let a=e.match(/(\d+):(\d+)\s+(am|pm)/i);if(!a)return null;let[i,o]=a.slice(1,3).map(Number),s=/pm/i.test(e),t=r?new Date(r):new Date;return t.setHours(i%12+(s?12:0),o,0,0),t.toISOString()}function I(r,e=S){for(let a of r){let i=e.messagesById[a.messageId]||{};for(let[o,s]of Object.entries(a)){let t=i[o];typeof s=="string"?(s?.length||0)>(t?.length||0)&&(i[o]=s):t||(i[o]=s)}e.messagesById[a.messageId]=i}}function P({document:r=document,navigator:e=typeof navigator>"u"?void 0:navigator,state:a=S,setIntervalFn:i=setInterval,clearIntervalFn:o=clearInterval}={}){r.body.insertAdjacentHTML("beforeend",'<button id="copy-btn" style="position:fixed;top:10px;right:10px;padding:10px;z-index:999;background-color:#fff;color:#000;">Copy 0 messages</button>');let s=r.getElementById("copy-btn"),t=()=>{I(w(r),a),s.textContent=`Copy ${Object.values(a.messagesById).filter(l=>l.text).length} messages`};t(),a.captureTimer=i(t,500),s.addEventListener("click",async()=>{o(a.captureTimer),a.captureTimer=null,s.remove();let l=Object.values(a.messagesById).sort((c,d)=>{let f=c.time?new Date(c.time).getTime():0,x=d.time?new Date(d.time).getTime():0;return f-x});await e?.clipboard?.writeText?.(JSON.stringify(l,null,2))})}function R(r,{author:e,quoteAuthor:a,quoteText:i,usedFallback:o,hasGif:s}={}){if(typeof r!="string")return r;let t=r;if(i){let l=i.replace(/\s+/g," ").trim(),c=[i,l,l.replace(/^"|"$/g,"")];for(let d of c){if(!d)continue;let f=y(d);f&&(t=t.replace(new RegExp(f,"gi"),""))}}if(o&&e){let l=y(e);t=t.replace(new RegExp(`^${l}\\s*`,"i"),"")}if(o&&a){let l=y(a);t=t.replace(new RegExp(l,"gi"),"")}return o&&(t=t.replace(/\bMaybe\b/gi,""),t=t.replace(/\+?\d[\d\s-]{5,}/g,"")),t=t.replace(/Your browser doesn't support video playback\.?/gi,"").replace(/\btenor\b/gi,"").replace(/\bforward-[\w-]+\b/gi,"").replace(/\b\d{1,2}:\d{2}\s*(?:am|pm)\b/gi,""),(s||/media-gif/i.test(t))&&(t="(media-gif)"),t=t.replace(/[“”]/g,'"'),t=t.replace(/\s+/g," ").trim(),t=t.replace(/^["']+|["']+$/g,"").trim(),t||(s?"(media-gif)":null)}function y(r){return r?r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):""}return B(k);})();
